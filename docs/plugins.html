<!doctype html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <title>Bone documents</title>
        <link rel="stylesheet" type="text/css" href="../dist/bootstrap/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="../dist/fontawesome/css/font-awesome.min.css">
        <link rel="stylesheet" type="text/css" href="../dist/css/style.css">
    </head>
    <body>
        <div class="container-fluid">
            <div id="main" class="row">
                <div id="navigation" class="col-md-3">
                    <h1>
                        <a href="./introduction.html">Bone</a>
                    </h1>
                    <div>
                        <a href="https://github.com/wyicwx/bone" class="gh-ico" target="_blank">
                            <i class="fa fa-github"></i> Star
                        </a>
                        <a href="https://github.com/wyicwx/bone" class="gh-ico" target="_blank">
                            <i class="fa fa-github"></i> Fork
                        </a>

                        <a href="https://github.com/wyicwx/bone/issues" class="gh-ico" target="_blank">
                            <i class="fa fa-github"></i> Issues
                        </a>
                        <div class="navbar-toggle collapsed">
                            <i class="fa fa-align-justify "></i>
                        </div>
                    </div>
                    <nav class="collapse navbar-collapse">
                        <h2>
                            使用入门
                        </h2>
                        <ul>
                            <li>
                                <a href="./introduction.html">Bone介绍</a>
                            </li>
                            <li>
                                <a href="./get_started.html">新手上路</a>
                            </li>
                            <li>
                                <a href="./api.html">常用API</a>
                            </li>
                            <li>
                                <a href="./plugins.html">处理器</a>
                            </li>
                            <li>
                                <a href="./cli.html">命令行CLI</a>
                            </li>
                            <li>
                                <a href="./server.html">开发服务器</a>
                            </li>
                            <li>
                                <a href="./example.html">bonefile.js示例</a>
                            </li>
                        </ul>
                        <h2>
                            高手进阶
                        </h2>
                        <ul>
                            <li>
                                <a href="./linked.html">调用Grunt、Gulp</a>
                            </li>
                        </ul>
                        <h2>
                            开发
                        </h2>
                        <ul>
                            <li>
                                <a href="./plugins_dev.html">处理器开发</a>
                            </li>
                            <li>
                                <a href="./cli_dev.html">cli开发</a>
                            </li>
                            <li>
                                <a href="./inner_api.html">内建API</a>
                            </li>
                        </ul>
                    </nav>
                    <script type="text/javascript">
                    (function() {
                        var toggle = document.querySelector('.navbar-toggle');
                        var navbar = document.querySelector('.navbar-collapse');
                        toggle.addEventListener('click', function() {
                            if(toggle.className.indexOf('collapsed') != -1) {
                                navbar.classList.add('in');
                                toggle.classList.remove('collapsed');
                            } else {
                                navbar.classList.remove('in');
                                toggle.classList.add('collapsed');
                            }
                        });
                    })();
                    </script>
                </div>
                <div id="content" class="col-md-9">
                    <div class="markdown-body">
                        <h1 id="-">处理器</h1>
<p>处理器是针对文件映射过程中对文件内容进行修改的处理单元</p>
<h4 id="-">安装处理器</h4>
<p>以<code>bone-act-less</code>作为例子</p>
<pre><code class="lang-shell">$ npm <span class="hljs-keyword">install</span> bone-act-<span class="hljs-keyword">less</span> <span class="hljs-comment">--save-dev</span>
</code></pre>
<h4 id="-">使用处理器</h4>
<p>和<code>node.js</code>中加载模块的方式不同，<code>bonefile.js</code>里使用<code>bone.require</code>函数加载处理器模块</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">var</span> bone = <span class="hljs-keyword">require</span>(<span class="hljs-string">'bone'</span>);
<span class="hljs-built_in">var</span> less = bone.<span class="hljs-keyword">require</span>(<span class="hljs-string">'bone-act-less'</span>);
</code></pre>
<p>使用<code>act()</code>函数加载处理器，<code>act()</code>函数可以多次调用来添加多个处理器，处理器的执行顺序和<code>act()</code>函数的调用顺序一致</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">var</span> bone = <span class="hljs-keyword">require</span>(<span class="hljs-string">'bone'</span>);
<span class="hljs-built_in">var</span> less = bone.<span class="hljs-keyword">require</span>(<span class="hljs-string">'bone-act-less'</span>);
<span class="hljs-built_in">var</span> cleancss = bone.<span class="hljs-keyword">require</span>(<span class="hljs-string">'bone-act-cleancss'</span>);

bone.dest(<span class="hljs-string">'dist'</span>)
    .src(<span class="hljs-string">'~/src/less/style.less'</span>)
    .act(less)
    .act(cleancss);
</code></pre>
<h4 id="-">传递参数给处理器</h4>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">bone</span><span class="hljs-selector-class">.dest</span>(<span class="hljs-string">'dist'</span>)
    <span class="hljs-selector-class">.src</span>(<span class="hljs-string">'~/src/less/style.less'</span>)
    <span class="hljs-selector-class">.act</span>(less({
        <span class="hljs-attribute">ieCompat</span>: false
    }));
</code></pre>
<h4 id="-">过滤器</h4>
<p>bone在调用处理器之前会经过过滤器筛选，过滤器通过判断文件的路径信息来决定是否使用该处理器</p>
<p>一般处理器模块内部设置了缺省的过滤器参数，处理器模块可以选择仅处理哪些类型的文件，以<code>bone-act-less</code>为例</p>
<pre><code class="lang-javascript">bone.dest(<span class="hljs-string">'dist'</span>)
    .src(<span class="hljs-string">'~/src/main.js'</span>)
    .act(less); <span class="hljs-comment">// less处理器只处理.less后缀的文件</span>
</code></pre>
<p>若想自定义处理过滤内容可以通过传递filter参数来修改，自定义的过滤器参数会覆盖缺省的参数</p>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">bone</span><span class="hljs-selector-class">.dest</span>(<span class="hljs-string">'dist'</span>)
    <span class="hljs-selector-class">.src</span>(<span class="hljs-string">'~/src/css/style.css'</span>)
    <span class="hljs-selector-class">.act</span>(less({}, {
        <span class="hljs-attribute">filter</span>: {
            <span class="hljs-attribute">ext</span>: [<span class="hljs-string">'.css'</span>]
        }
    }));
</code></pre>
<p><code>filter</code>参数也可以传递函数，下面是所有可以传递的数据结构</p>
<pre><code class="lang-javascript"><span class="hljs-selector-tag">bone</span><span class="hljs-selector-class">.dest</span>(<span class="hljs-string">'dist'</span>)
    <span class="hljs-selector-class">.src</span>(<span class="hljs-string">'~/src/css/style.css'</span>)
    <span class="hljs-selector-class">.act</span>(less({}, {
        <span class="hljs-attribute">filter</span>: {
            <span class="hljs-attribute">ext</span>: [<span class="hljs-string">'.css'</span>], <span class="hljs-comment">// 优先判断后缀</span>
            <span class="hljs-attribute">name</span>: <span class="hljs-string">'style'</span>,
            <span class="hljs-attribute">base</span>: <span class="hljs-string">'style.css'</span>
        }
    }));

<span class="hljs-selector-tag">bone</span><span class="hljs-selector-class">.dest</span>(<span class="hljs-string">'dist'</span>)
    <span class="hljs-selector-class">.src</span>(<span class="hljs-string">'~/src/css/style.css'</span>)
    <span class="hljs-selector-class">.act</span>(less({}, {
        <span class="hljs-attribute">filter</span>: function(fileInfo) { 
            <span class="hljs-comment">//  fileInfo = {</span>
            <span class="hljs-comment">//      source: '/work/project/src/css/style.css',</span>
            <span class="hljs-comment">//      sourceParsed: {</span>
            <span class="hljs-comment">//          root: '/',</span>
            <span class="hljs-comment">//          dir: '/work/project/src/css',</span>
            <span class="hljs-comment">//          base: 'style.css',</span>
            <span class="hljs-comment">//          ext: '.css',</span>
            <span class="hljs-comment">//          name: 'style' </span>
            <span class="hljs-comment">//      },</span>
            <span class="hljs-comment">//      destination: '/work/project/dist/style.css',</span>
            <span class="hljs-comment">//      destinationParsed: {</span>
            <span class="hljs-comment">//          root: '/',</span>
            <span class="hljs-comment">//          dir: '/work/project/dist',</span>
            <span class="hljs-comment">//          base: 'style.css',</span>
            <span class="hljs-comment">//          ext: '.css',</span>
            <span class="hljs-comment">//          name: 'style'</span>
            <span class="hljs-comment">//      }</span>
            <span class="hljs-comment">//  }</span>

            return true;
        }
    }));
</code></pre>
<h4 id="-">自定义简易的处理器</h4>
<p>若想快速定义一个简易的处理器可以通过<code>bone.wrapper</code>函数</p>
<pre><code class="lang-javascript">bone.dest(<span class="hljs-string">'dist'</span>)
    .src(<span class="hljs-string">'~/src/css/style.css'</span>)
    .act(bone.wrapper(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(buffer, encoding, callback)</span> </span>{
        <span class="hljs-keyword">callback</span>(<span class="hljs-literal">null</span>, buffer);
    }, {
        filter: {
            ext: <span class="hljs-string">'.css'</span>
        }
    }));
</code></pre>
<p>处理器开发相关的文档请参阅<a href="./plugins_dev.html">处理器开发</a></p>
<h1 id="-">常用处理器</h1>
<ul>
<li><a href="https://github.com/wyicwx/bone-act-less">bone-act-less</a> less编译器</li>
<li><a href="https://github.com/jansesun/bone-act-sass">bone-act-sass</a> sass编译器</li>
<li><a href="https://github.com/wyicwx/bone-act-concat">bone-act-concat</a> 文件合并</li>
<li><a href="https://github.com/wyicwx/bone-act-include">bone-act-include</a> include功能</li>
<li><a href="https://github.com/wyicwx/bone-act-htmllayout">bone-act-htmllayout</a> 为html文件提供layout功能</li>
<li><a href="https://github.com/wyicwx/bone-act-babel">bone-act-babel</a> babel</li>
<li><a href="https://github.com/wyicwx/bone-act-uglify">bone-act-uglify</a> uglify压缩器</li>
<li><a href="https://github.com/wyicwx/bone-act-cleancss">bone-act-cleancss</a> css压缩器</li>
</ul>

                    </div>
                </div>
            </div>
        </div>
    </body>
</html>